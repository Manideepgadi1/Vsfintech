<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Indices Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f8f9fa;
            padding: 30px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .category-section {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .board-header {
            background: #000080;
            color: white;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1em;
        }

        .sort-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .sort-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .indices-list {
            padding: 10px;
        }

        .index-item {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .index-item:hover {
            transform: translateY(-2px);
        }

        .index-item.selected .index-name {
            box-shadow: 0 0 0 2px #000080;
        }

        .index-name {
            background: white;
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85em;
            flex: 1;
            text-align: center;
        }

        .index-value {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.9em;
            min-width: 60px;
            text-align: center;
        }

        .color-green {
            background: #00ff00;
            color: #000;
        }

        .color-light-green {
            background: #90ee90;
            color: #000;
        }

        .color-yellow {
            background: #ffff00;
            color: #000;
        }

        .color-orange {
            background: #ff6b35;
            color: white;
        }

        .color-red {
            background: #ff0000;
            color: white;
        }

        .selected-section {
            margin-top: 30px;
            display: none;
        }

        .selected-header {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border: 1px solid #dee2e6;
        }

        .selected-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .selected-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .selected-tag {
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            gap: 8px;
        }

        .remove-tag {
            cursor: pointer;
            color: #dc3545;
            font-weight: bold;
        }

        .correlation-btn {
            background: #000080;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }

        .correlation-btn:hover {
            background: #000066;
        }

        .correlation-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .basket-table, .correlation-table {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border: 1px solid #dee2e6;
        }

        .basket-table h3, .correlation-table h3 {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .basket-data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .basket-data-table th {
            background: #000080;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #000066;
        }

        .basket-data-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
            font-weight: 500;
        }

        .correlation-table {
            display: none;
        }

        .legend {
            background: #fff;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-top: 25px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .legend-items {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
        }

        .legend-color {
            width: 40px;
            height: 18px;
            border-radius: 3px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="categories-grid" id="categoriesContainer">
            <div class="loading">Loading data...</div>
        </div>
        
        <div class="selected-section" id="selectedSection">
            <div class="selected-header">
                <div class="selected-title">Selected Indices Basket</div>
                <div class="selected-list" id="selectedList"></div>
                <button class="correlation-btn" id="correlationBtn" disabled>Correlation</button>
            </div>
            
            <div class="basket-table" id="basketTable" style="display:none;">
                <h3>Sector Basket</h3>
                <table class="basket-data-table">
                    <thead>
                        <tr>
                            <th>Indices</th>
                            <th>Percentile</th>
                            <th>Del</th>
                        </tr>
                    </thead>
                    <tbody id="basketTableBody"></tbody>
                </table>
            </div>
            
            <div class="correlation-table" id="correlationTable">
                <h3>Correlation</h3>
                <table class="basket-data-table" id="correlationDataTable"></table>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-items">
                <div class="legend-item"><div class="legend-color color-green"></div><span>0.0-0.2</span></div>
                <div class="legend-item"><div class="legend-color color-light-green"></div><span>0.2-0.4</span></div>
                <div class="legend-item"><div class="legend-color color-yellow"></div><span>0.4-0.6</span></div>
                <div class="legend-item"><div class="legend-color color-orange"></div><span>0.6-0.8</span></div>
                <div class="legend-item"><div class="legend-color color-red"></div><span>0.8-1.0</span></div>
            </div>
        </div>
    </div>

    <script>
        let allData = { 'Broad Market': [], 'Sectoral': [], 'Strategy': [], 'Thematic': [] };
        let selectedIndices = [];
        let sortStates = { 'Broad Market': 'none', 'Sectoral': 'none', 'Strategy': 'none', 'Thematic': 'none' };

        function getColorClass(value) {
            if (value < 0.2) return 'color-green';
            if (value < 0.4) return 'color-light-green';
            if (value < 0.6) return 'color-yellow';
            if (value < 0.8) return 'color-orange';
            return 'color-red';
        }

        async function loadData() {
            try {
                const response = await fetch('data/indices_with_short_names.json');
                const data = await response.json();
                
                data.forEach(item => {
                    const category = item.category;
                    allData[category].push(item);
                });

                displayData();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('categoriesContainer').innerHTML = 
                    '<div class="loading">Error loading data</div>';
            }
        }

        function sortCategory(category) {
            if (sortStates[category] === 'none' || sortStates[category] === 'desc') {
                sortStates[category] = 'asc';
            } else {
                sortStates[category] = 'desc';
            }
            displayData();
        }

        function getSortedData(category) {
            const data = [...allData[category]];
            if (sortStates[category] === 'asc') {
                return data.sort((a, b) => a.percentile - b.percentile);
            } else if (sortStates[category] === 'desc') {
                return data.sort((a, b) => b.percentile - a.percentile);
            }
            return data;
        }

        function toggleSelection(displayName, fullName, percentile) {
            const index = selectedIndices.findIndex(item => item.displayName === displayName);
            if (index > -1) {
                selectedIndices.splice(index, 1);
            } else {
                selectedIndices.push({ displayName, fullName, percentile });
            }
            updateSelected();
            displayData();
        }

        function updateSelected() {
            const section = document.getElementById('selectedSection');
            const list = document.getElementById('selectedList');
            const btn = document.getElementById('correlationBtn');

            if (selectedIndices.length > 0) {
                section.style.display = 'block';
                list.innerHTML = '';

                selectedIndices.forEach(item => {
                    const tag = document.createElement('div');
                    tag.className = 'selected-tag';
                    tag.innerHTML = `<span>${item.displayName}</span><span class="remove-tag">├ù</span>`;
                    
                    tag.querySelector('.remove-tag').addEventListener('click', function() {
                        toggleSelection(item.displayName, item.fullName, item.percentile);
                    });
                    
                    list.appendChild(tag);
                });

                btn.disabled = selectedIndices.length < 2;
                updateBasket();
                document.getElementById('basketTable').style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        function updateBasket() {
            const tbody = document.getElementById('basketTableBody');
            tbody.innerHTML = '';

            selectedIndices.forEach(item => {
                const row = document.createElement('tr');
                const colorClass = getColorClass(item.percentile);
                
                row.innerHTML = `
                    <td style="font-weight:600;text-align:left;">${item.displayName}</td>
                    <td><div class="${colorClass}" style="display:inline-block;padding:6px 12px;border-radius:4px;font-weight:700;">${item.percentile.toFixed(2)}</div></td>
                    <td><button class="delete-btn" style="background:#dc3545;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;">-</button></td>
                `;

                row.querySelector('.delete-btn').addEventListener('click', function() {
                    toggleSelection(item.displayName, item.fullName, item.percentile);
                });

                tbody.appendChild(row);
            });
        }

        function displayData() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';

            ['Broad Market', 'Sectoral', 'Strategy', 'Thematic'].forEach(category => {
                const section = document.createElement('div');
                section.className = 'category-section';
                
                const header = document.createElement('div');
                header.className = 'board-header';
                
                const title = document.createElement('span');
                title.textContent = category.replace(' Market', '').replace('al', '');
                
                const sortBtn = document.createElement('button');
                sortBtn.className = 'sort-btn';
                sortBtn.textContent = 'Values Γåò';
                sortBtn.addEventListener('click', () => sortCategory(category));
                
                header.appendChild(title);
                header.appendChild(sortBtn);
                section.appendChild(header);

                const list = document.createElement('div');
                list.className = 'indices-list';

                const dataToShow = getSortedData(category);

                dataToShow.forEach(index => {
                    const item = document.createElement('div');
                    item.className = 'index-item';
                    
                    const isSelected = selectedIndices.some(i => i.displayName === index.displayName);
                    if (isSelected) {
                        item.classList.add('selected');
                    }

                    const colorClass = getColorClass(index.percentile);

                    item.innerHTML = `
                        <span class="index-name">${index.displayName}</span>
                        <span class="index-value ${colorClass}">${index.percentile.toFixed(2)}</span>
                    `;

                    item.addEventListener('click', function() {
                        toggleSelection(index.displayName, index.fullName, index.percentile);
                    });

                    list.appendChild(item);
                });

                section.appendChild(list);
                container.appendChild(section);
            });
        }

        document.getElementById('correlationBtn').addEventListener('click', function() {
            const corrTable = document.getElementById('correlationTable');
            const dataTable = document.getElementById('correlationDataTable');
            corrTable.style.display = 'block';

            let html = '<thead><tr><th></th>';
            selectedIndices.forEach(item => html += `<th>${item.displayName}</th>`);
            html += '</tr></thead><tbody>';

            selectedIndices.forEach((item1, x) => {
                html += `<tr><th style="background:#000080;color:white;">${item1.displayName}</th>`;
                selectedIndices.forEach((item2, y) => {
                    if (x === y) {
                        html += '<td style="background:#ff0000;color:white;font-weight:bold;">1.00</td>';
                    } else {
                        const corr = (Math.random() * 0.8).toFixed(2);
                        let bg, color;
                        if (corr >= 0.7) {
                            bg = '#ff0000'; color = 'white';
                        } else if (corr >= 0.5) {
                            bg = '#ff6b35'; color = 'white';
                        } else if (corr >= 0.3) {
                            bg = '#ffff00'; color = '#000';
                        } else {
                            bg = '#90ee90'; color = '#000';
                        }
                        html += `<td style="background:${bg};color:${color};font-weight:bold;">${corr}</td>`;
                    }
                });
                html += '</tr>';
            });

            html += '</tbody>';
            dataTable.innerHTML = html;
            corrTable.scrollIntoView({ behavior: 'smooth' });
        });

        loadData();
    </script>
</body>
</html>
